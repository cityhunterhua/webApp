{"version":3,"sources":["../../src/util/await.js"],"names":[],"mappings":"AAAA;;;;;;;;;;;;;;;;;;;;;;;;;AAWE,oBAAa;AAAA;;AACX,SAAK,IAAL;AACD;;;;;;;mBAKD,I,mBAAM;AACJ,SAAK,KAAL,GAAa,EAAb;AACD,G;;;;;;;;;mBAOD,G,gBAAI,G,EAAK,E,EAAG;AAAA;;AACV,QAAG,EAAE,OAAO,KAAK,KAAd,CAAH,EAAwB;AACtB,WAAK,KAAL,CAAW,GAAX,IAAkB,EAAlB;AACA,aAAO,kBAAQ,OAAR,CAAgB,IAAhB,EAAsB,IAAtB,CAA2B,gBAAQ;AACxC,gBAAQ,QAAR,CAAiB,YAAM;AACrB,gBAAK,KAAL,CAAW,GAAX,EAAgB,OAAhB,CAAwB;AAAA,mBAAY,SAAS,OAAT,CAAiB,IAAjB,CAAZ;AAAA,WAAxB;AACA,iBAAO,MAAK,KAAL,CAAW,GAAX,CAAP;AACD,SAHD;AAIA,eAAO,IAAP;AACD,OANM,EAMJ,KANI,CAME,eAAO;AACd,gBAAQ,QAAR,CAAiB,YAAM;AACrB,gBAAK,KAAL,CAAW,GAAX,EAAgB,OAAhB,CAAwB;AAAA,mBAAY,SAAS,MAAT,CAAgB,GAAhB,CAAZ;AAAA,WAAxB;AACA,iBAAO,MAAK,KAAL,CAAW,GAAX,CAAP;AACD,SAHD;AAIA,eAAO,MAAM,MAAN,CAAa,GAAb,CAAP;AACD,OAZM,CAAP;AAaD,KAfD,MAeK;AACH,UAAI,WAAW,MAAM,KAAN,EAAf;AACA,WAAK,KAAL,CAAW,GAAX,EAAgB,IAAhB,CAAqB,QAArB;AACA,aAAO,SAAS,OAAhB;AACD;AACF,G","file":"await.js","sourcesContent":["'use strict';\n/**\n * waiting class\n * @type {}\n */\nexport default class {\n  /**\n   * constructor\n   * @param  {} args []\n   * @return {}         []\n   */\n  constructor(){\n    this.init();\n  }\n  /**\n   * init\n   * @return {} []\n   */\n  init(){\n    this.queue = {};\n  }\n  /**\n   * run\n   * @param  {String}   key []\n   * @param  {Function} fn  []\n   * @return {Promise}       []\n   */\n  run(key, fn){\n    if(!(key in this.queue)){\n      this.queue[key] = [];\n      return Promise.resolve(fn()).then(data => {\n        process.nextTick(() => {\n          this.queue[key].forEach(deferred => deferred.resolve(data));\n          delete this.queue[key];\n        });\n        return data;\n      }).catch(err => {\n        process.nextTick(() => {\n          this.queue[key].forEach(deferred => deferred.reject(err));\n          delete this.queue[key];\n        });\n        return think.reject(err);\n      });\n    }else{\n      let deferred = think.defer();\n      this.queue[key].push(deferred);\n      return deferred.promise;\n    }\n  }\n}"]}