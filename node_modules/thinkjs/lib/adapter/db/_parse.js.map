{"version":3,"sources":["../../../src/adapter/db/_parse.js"],"names":[],"mappings":"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","file":"_parse.js","sourcesContent":["'use strict';\n\nimport querystring from 'querystring';\n\n/**\n * sql parse class\n */\nexport default class extends think.base {\n  /**\n   * init\n   * @return {} []\n   */\n  init(config = {}){\n    this.config = config;\n    //operate\n    this.comparison = {\n      'EQ': '=',\n      'NEQ': '!=',\n      '<>': '!=',\n      'GT': '>',\n      'EGT': '>=',\n      'LT': '<',\n      'ELT': '<=',\n      'NOTLIKE': 'NOT LIKE',\n      'LIKE': 'LIKE',\n      'IN': 'IN',\n      'NOTIN': 'NOT IN'\n    };\n    this.selectSql = '%EXPLAIN%SELECT%DISTINCT% %FIELD% FROM %TABLE%%JOIN%%WHERE%%GROUP%%HAVING%%ORDER%%LIMIT%%UNION%%COMMENT%';\n  }\n  /**\n   * parse explain\n   * @param  {Boolean} explain []\n   * @return {String}         []\n   */\n  parseExplain(explain) {\n    if(!explain){\n      return '';\n    }\n    return 'EXPLAIN ';\n  }\n  /**\n   * parse set\n   * @param  {Object} data []\n   * @return {String}      []\n   */\n  parseSet(data = {}){\n    let set = [];\n    for(let key in data){\n      let value = this.parseValue(data[key]);\n      if (think.isString(value) || think.isNumber(value)) {\n        set.push(this.parseKey(key) + '=' + value);\n      }\n    }\n    if(set.length){\n      return ' SET ' + set.join(',');\n    }\n    return '';\n  }\n  /**\n   * parse key\n   * @param  {String} key []\n   * @return {String}     []\n   */\n  parseKey(key){\n    return key;\n  }\n  /**\n   * parse value\n   * @param  {Mixed} value []\n   * @return {Mixed}       []\n   */\n  parseValue(value){\n    if (think.isString(value)) {\n      value = '\\'' + this.escapeString(value) + '\\'';\n    }else if(think.isArray(value)){\n      if (/^exp$/.test(value[0])) {\n        value = value[1];\n      }else{\n        value = value.map(item => this.parseValue(item));\n      }\n    }else if(think.isBoolean(value)){\n      value = value ? '1' : '0';\n    }else if (value === null) {\n      value = 'null';\n    }\n    return value;\n  }\n  /**\n   * parse field\n   * parseField('name');\n   * parseField('name,email');\n   * parseField({\n   *     xx_name: 'name',\n   *     xx_email: 'email'\n   * })\n   * @return {String} []\n   */\n  parseField(fields){\n    if (think.isString(fields)) {\n      //fields('id, instr('30,35,31,',id+',') as d')\n      if(fields.indexOf('(') > -1 && fields.indexOf(')') > -1){\n        return fields;\n      }\n      if(fields.indexOf(',') > -1){\n        fields = fields.split(/\\s*,\\s*/);\n      }\n    }\n    if (think.isArray(fields)) {\n      return fields.map(item => this.parseKey(item)).join(',');\n    }else if(think.isObject(fields)){\n      let data = [];\n      for(let key in fields){\n        data.push(this.parseKey(key) + ' AS ' + this.parseKey(fields[key]));\n      }\n      return data.join(',');\n    }else if(think.isString(fields) && fields){\n      return this.parseKey(fields);\n    }\n    return '*';\n  }\n  /**\n   * parse table\n   * @param  {Mixed} tables []\n   * @return {}        []\n   */\n  parseTable(table){\n    if (think.isString(table)) {\n      table = table.split(/\\s*,\\s*/);\n    }\n    if (think.isArray(table)) {\n      return table.map(item => this.parseKey(item)).join(',');\n    }else if (think.isObject(table)) {\n      let data = [];\n      for(let key in table){\n        data.push(this.parseKey(key) + ' AS ' + this.parseKey(table[key]));\n      }\n      return data.join(',');\n    }\n    return '';\n  }\n  /**\n   * get logic\n   * @param  {String} logic    []\n   * @param  {String} _default []\n   * @return {String}          []\n   */\n  getLogic(logic, _default = 'AND'){\n    let list = ['AND', 'OR', 'XOR'];\n    if(think.isObject(logic)){\n      let _logic = logic._logic;\n      delete logic._logic;\n      logic = _logic;\n    }\n    if(!logic || !think.isString(logic)){\n      return _default;\n    }\n    logic = logic.toUpperCase();\n    if(list.indexOf(logic) > -1){\n      return logic;\n    }\n    return _default;\n  }\n  /**\n   * parse where\n   * @param  {Mixed} where []\n   * @return {String}       []\n   */\n  parseWhere(where){\n    if(think.isEmpty(where)){\n      return '';\n    }else if (think.isString(where)) {\n      return ` WHERE ${where}`;\n    }\n    let logic = this.getLogic(where);\n    //safe key regexp\n    let keySafeRegExp = /^[\\w\\|\\&\\-\\.\\(\\)\\,]+$/;\n    let multi = where._multi;\n    delete where._multi;\n\n    let key, val, result = [], str = '';\n\n    let fn = (item, i) => {\n      let v = multi ? val[i] : val;\n      return '(' + this.parseWhereItem(this.parseKey(item), v) + ')';\n    };\n    \n    for(key in where){\n      val = where[key];\n      str = '( ';\n      //_string: ''\n      if (['_string', '_complex', '_query'].indexOf(key) > -1) {\n        str += this.parseThinkWhere(key, val);\n      }\n      else if (!keySafeRegExp.test(key)) {\n        throw new Error(think.locale('INVALID_WHERE_CONDITION_KEY'));\n      }\n      //title|content\n      else if (key.indexOf('|') > -1) {\n        str += key.split('|').map(fn).join(' OR ');\n      }\n      //title&content\n      else if (key.indexOf('&') > -1) {\n        str += key.split('&').map(fn).join(' AND ');\n      }else{\n        str += this.parseWhereItem(this.parseKey(key), val);\n      }\n      str += ' )';\n      result.push(str);\n    }\n    result = result.join(` ${logic} `);\n    return result ? (` WHERE ` + result) : '';\n  }\n /**\n  * parse where item\n  * @param  {String} key []\n  * @param  {Mixed} val []\n  * @return {String}     []\n  */\n  parseWhereItem(key, val){\n    // {id: null}\n    if(val === null){\n      return `${key} IS NULL`;\n    }\n    // {id: {'<': 10, '>': 1}}\n    else if (think.isObject(val)) { \n      let logic = this.getLogic(val);\n      let result = [];\n      for(let opr in val){\n        let nop = opr.toUpperCase();\n        nop = this.comparison[nop] || nop;\n        let parsedValue = this.parseValue(val[opr]);\n        //{id: {IN: [1, 2, 3]}}\n        if(think.isArray(parsedValue)){\n          result.push(`${key} ${nop} (${parsedValue.join(', ')})`);\n        }\n        else if(parsedValue === 'null'){\n          result.push(key + ' ' + (nop === '!=' ? 'IS NOT NULL' : 'IS NULL'));\n        }\n        else{\n          result.push(key + ' ' + nop + ' ' + parsedValue);\n        }\n      }\n      return result.join(' ' + logic + ' ');\n    }\n    // where({id: [1, 2, 3]})\n    else if(think.isArray(val)){\n      let flag = think.isNumber(val[0]) || think.isNumberString(val[0]);\n      if(flag){\n        flag = val.every(item => {\n          return think.isNumber(item) || think.isNumberString(item);\n        });\n        if(flag){\n          return `${key} IN ( ${val.join(', ')} )`;\n        }\n      }\n    }\n    else {\n      return key + ' = ' + this.parseValue(val);\n    }\n\n    let whereStr = '';\n    let data;\n    if (think.isString(val[0])) {\n      let val0 = val[0].toUpperCase();\n      val0 = this.comparison[val0] || val0;\n      // compare\n      if (/^(=|!=|>|>=|<|<=)$/.test(val0)) {\n        if(val[1] === null){\n          whereStr += key + ' ' + (val[0] === '!=' ? 'IS NOT NULL' : 'IS NULL');\n        }else{\n          whereStr += key + ' ' + val0 + ' ' + this.parseValue(val[1]);\n        }\n      }\n      // like or not like\n      else if (/^(NOT\\s+LIKE|LIKE)$/.test(val0)) { \n        if (think.isArray(val[1])) {\n          //get like logic, default is OR\n          let likeLogic = this.getLogic(val[2], 'OR');\n          let like = val[1].map(item => key + ' ' + val0 + ' ' + this.parseValue(item)).join(' ' + likeLogic + ' ');\n          whereStr += '(' + like + ')';\n        }else{\n          whereStr += key + ' ' + val0 + ' ' + this.parseValue(val[1]);\n        }\n      }\n      // exp\n      else if(val0 === 'EXP'){ \n        whereStr += '(' + key + ' ' + val[1] + ')';\n      }\n      // in or not in\n      else if(val0 === 'IN' || val0 === 'NOT IN'){\n        if (val[2] === 'exp') {\n          whereStr += key + ' ' + val0 + ' ' + val[1];\n        }else{\n          if (think.isString(val[1])) {\n            val[1] = val[1].split(',');\n          }\n          if (!think.isArray(val[1])) {\n            val[1] = [val[1]];\n          }\n          val[1] = this.parseValue(val[1]);\n          if (val[1].length === 1) {\n            whereStr += key + (val0 === 'IN' ? ' = ' : ' != ') + val[1];\n          }else{\n            whereStr += key + ' ' + val0 + ' (' + val[1].join(',') + ')';\n          }\n        }\n      }\n      //between\n      else if(val0 === 'BETWEEN'){\n        data = think.isString(val[1]) ? val[1].split(',') : val[1];\n        if (!think.isArray(data)) {\n          data = [val[1], val[2]];\n        }\n        whereStr += ' (' + key + ' ' + val0 + ' ' + this.parseValue(data[0]);\n        whereStr += ' AND ' + this.parseValue(data[1]) + ')';\n      }else{\n        throw new Error(think.locale('WHERE_CONDITION_INVALID', key, JSON.stringify(val)));\n      }\n    }else{\n\n      let length = val.length;\n      let logic = this.getLogic(val[length - 1], '');\n      if(logic){\n        length--;\n      }else{\n        logic = 'AND';\n      }\n      let result = [];\n      for(let i = 0; i < length; i++){\n        let isArr = think.isArray(val[i]);\n        data = isArr ? val[i][1] : val[i];\n        let exp = ((isArr ? val[i][0] : '') + '').toUpperCase();\n        if (exp === 'EXP') {\n          result.push(`(${key} ${data})`);\n        }else{\n          let op = isArr ? (this.comparison[val[i][0].toUpperCase()] || val[i][0]) : '=';\n          result.push(`(${key} ${op} ${this.parseValue(data)})`);\n        }\n      }\n      whereStr = result.join(` ${logic} `);\n    }\n    return whereStr;\n  }\n  /**\n   * parse special condition\n   * @param  {String} key []\n   * @param  {Mixed} val []\n   * @return {String}     []\n   */\n  parseThinkWhere(key, val){\n    switch(key){\n      case '_string':\n        return val;\n      case '_complex':\n        return this.parseWhere(val).substr(6);\n      case '_query':\n        let where = think.isString(val) ? querystring.parse(val) : val;\n        let logic = this.getLogic(where);\n        let arr = [];\n        for(let name in where){\n          val = this.parseKey(name) + ' = ' + this.parseValue(where[name]);\n          arr.push(val);\n        }\n        return arr.join(` ${logic} `);\n    }\n    return '';\n  }\n  /**\n   * parse limit\n   * @param  {String} limit []\n   * @return {}       []\n   */\n  parseLimit(limit){\n    if (think.isEmpty(limit)) {\n      return '';\n    }\n    if(think.isNumber(limit)){\n      limit = Math.max(limit, 0);\n      return ` LIMIT ${limit}`;\n    }\n    if(think.isString(limit)){\n      limit = limit.split(/\\s*,\\s*/);\n    }\n    let data = [Math.max(limit[0] | 0, 0)];\n    if(limit[1]){\n      data.push(Math.max(limit[1] | 0, 0));\n    }\n    return ' LIMIT ' + data.join(',');\n  }\n  /**\n   * parse join\n   * @param  {String} join []\n   * @return {String}      []\n   */\n  parseJoin(join, options = {}){\n    if (think.isEmpty(join)) {\n      return '';\n    }\n    let joinStr = '';\n    let defaultJoin = ' LEFT JOIN ';\n    if (think.isArray(join)) {\n      let joins = {\n        'left': ' LEFT JOIN ',\n        'right': ' RIGHT JOIN ',\n        'inner': ' INNER JOIN '\n      };\n      join.forEach(val => {\n        if (think.isString(val)) {\n          let hasJoin = val.toLowerCase().indexOf(' join ') > -1;\n          joinStr += (hasJoin ? ' ' : defaultJoin) + val;\n        }else if (think.isObject(val)) {\n          let ret = [];\n          if (!('on' in val)) {\n            for(let key in val){\n              let v = val[key];\n              if(think.isObject(v)){\n                v.table = key;\n                ret.push(v);\n              }else{\n                ret.push(val);\n                break;\n              }\n            }\n          }else{\n            ret.push(val);\n          }\n          ret.forEach(item => {\n            let joinType = joins[item.join] || item.join || defaultJoin;\n            let table = item.table.trim();\n            //table is sql\n            if( table.indexOf(' ') > -1 ) {\n              if( table.indexOf('(') !== 0 ) {\n                table = '(' + table + ')';\n              }\n              joinStr += joinType + table;\n            } else {\n              table = options.tablePrefix + table;\n              if(table.indexOf('.') === -1){\n                joinStr += joinType + '`' + table + '`';\n              }else{\n                joinStr += joinType + table;\n              }\n            }\n            if (item.as) {\n              joinStr += ' AS `' + item.as + '`';\n            }\n            if (item.on) {\n              let mTable = options.alias || options.table;\n              if(mTable.indexOf('.') === -1){\n                mTable = '`' + mTable + '`';\n              }\n              let jTable = item.as || table;\n              if(jTable.indexOf('.') === -1){\n                jTable = '`' + jTable + '`';\n              }\n              if (think.isObject(item.on)) {\n                let where = [];\n                for(let key in item.on){\n                  where.push([\n                    key.indexOf('.') > -1 ? key : (mTable + '.`' + key + '`'),\n                    '=',\n                    item.on[key].indexOf('.') > -1 ? item.on[key] : (jTable + '.`' + item.on[key] + '`')\n                  ].join(''));\n                }\n                joinStr += ' ON (' + where.join(' AND ') + ')';\n              }else{\n                if (think.isString(item.on)) {\n                  item.on = item.on.split(/\\s*,\\s*/);\n                }\n                joinStr += ' ON ' + (item.on[0].indexOf('.') > -1 ? item.on[0] : (mTable + '.`' + item.on[0] + '`'));\n                joinStr += ' = ' + (item.on[1].indexOf('.') > -1 ? item.on[1] : (jTable + '.`' + item.on[1] + '`'));\n              }\n            }\n          });\n        }\n      });\n    }else{\n      joinStr += defaultJoin + join;\n    }\n    return joinStr;\n  }\n  /**\n   * parse order\n   * @param  {String} order []\n   * @return {String}       []\n   */\n  parseOrder(order){\n    if(think.isEmpty(order)){\n      return '';\n    }\n    if (think.isArray(order)) {\n      order = order.map(item => this.parseKey(item)).join(',');\n    }else if (think.isObject(order)) {\n      let arr = [];\n      for(let key in order){\n        let val = order[key];\n        val = this.parseKey(key) + ' ' + val;\n        arr.push(val);\n      }\n      order = arr.join(',');\n    }\n    return ` ORDER BY ${order}`;\n  }\n  /**\n   * parse group\n   * @param  {String} group []\n   * @return {String}       []\n   */\n  parseGroup(group){\n    if (think.isEmpty(group)) {\n      return '';\n    }\n    if (think.isString(group)) {\n      //group may be `date_format(create_time,'%Y-%m-%d')`\n      if(group.indexOf('(') !== -1){\n        return ' GROUP BY ' + group;\n      }\n      group = group.split(/\\s*,\\s*/);\n    }\n    let result = group.map(item => {\n      if (item.indexOf('.') === -1) {\n        return '`' + item + '`';\n      }else{\n        item = item.split('.');\n        return item[0] + '.`' + item[1] + '`'; \n      }\n    });\n    return ' GROUP BY ' + result.join(',');\n  }\n  /**\n   * parse having\n   * @param  {String} having []\n   * @return {}        []\n   */\n  parseHaving(having){\n    return having ? ` HAVING ${having}` : '';\n  }\n  /**\n   * parse comment\n   * @param  {String} comment []\n   * @return {String}         []\n   */\n  parseComment(comment){\n    return comment ? (` /*${comment}*/`) : '';   \n  }\n  /**\n   * parse distinct\n   * @param  {} distinct []\n   * @return {}          []\n   */\n  parseDistinct(distinct){\n    return distinct ? ' DISTINCT' : '';\n  }\n  /**\n   * parse union\n   * @param  {String} union []\n   * @return {}       []\n   */\n  parseUnion(union){\n    if (think.isEmpty(union)) {\n      return '';\n    }\n    if (think.isArray(union)) {\n      let sql = ' ';\n      union.forEach(item => {\n        sql += item.all ? 'UNION ALL ' : 'UNION ';\n        sql += '(' + (think.isObject(item.union) ? this.buildSelectSql(item.union) : item.union) + ')';\n      });\n      return sql;\n    }else{\n      return ' UNION (' + (think.isObject(union) ? this.buildSelectSql(union) : union) + ')'; \n    }\n  }\n  /**\n   * parse lock\n   * @param  {Boolean} lock []\n   * @return {}      []\n   */\n  parseLock(lock){\n    if (!lock) {\n      return '';\n    }\n    return ' FOR UPDATE ';\n  }\n  /**\n   * parse sql\n   * @param  {String} sql     []\n   * @param  {Object} options []\n   * @return {String}         []\n   */\n  parseSql(sql, options){\n    return sql.replace(/\\%([A-Z]+)\\%/g, (a, type) => {\n      type = type.toLowerCase();\n      let ucfirst = type[0].toUpperCase() + type.slice(1);\n      if(think.isFunction(this['parse' + ucfirst])){\n        return this['parse' + ucfirst](options[type] || '', options);\n      }\n      return a;\n    }).replace(/\\s__([A-Z_-]+)__\\s/g, (a, b) => {\n      return ' `' + this.config.prefix + b.toLowerCase() + '` ';\n    });\n  }\n  /**\n   * escape string, override in sub class\n   * @param  {String} str []\n   * @return {String}     []\n   */\n  escapeString(str){\n    return str;\n  }\n  /**\n   * get select sql\n   * @param  {Object} options []\n   * @return {String}         [sql string]\n   */\n  buildSelectSql(options){\n    return this.parseSql(this.selectSql, options) + this.parseLock(options.lock);\n  }\n}"]}